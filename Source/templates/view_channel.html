<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">
                    <img src="{{ url_for('static', filename='favicon.ico') }}" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
                    Video School CMS
                </span>
              <a class="d-flex btn btn-outline-light" href="{{ url_for('logout') }}">Logout</a>
            </div>
        </nav>
    <div class="row p-2">
        <nav class="gx-5" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{url_for('dashboard')}}">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page">Channel</li>
            </ol>
        </nav>
    </div>
    <div class='container'>
        <h1>Channel name: {{ channel[1] }}</h1>
        <p>Channel Platform: {{ channel[2] }}</p>
        <p>Assigned Users:-</p>
        <ul>
            <p>Manager: {{ users[channel[5]] }}</p>
            <p>Ops: {{ users[channel[6]] }}</p>
            <p>Creator: {{ users[channel[3]] }}</p>
            <p>Editor: {{ users[channel[4]] }}</p>
        </ul>
    
        <h1>Videos table:-</h1>
        <table class='table table-hover'>
            <thead>
                <th scope="col">ID</th>
                <th scope="col">Old ID</th>
                <th scope="col">Title</th>
                <th scope="col">Shoot Date</th>
                <th scope="col">Edit Date</th>
                <th scope="col">Upload Date</th>
                <th scope="col">Status</th>
                <th scope="col">Update Status</th>
                <th scope="col">Comment</th>
                {% if sessionvar['user_type'] < 3 or sessionvar['user_type'] == 4 %}
                    <th scope="col">Edit</th>
                {% endif %}
                {% if sessionvar['user_type'] < 3 %}
                    <th scope="col">Delete</th>
                {% endif %}
            </thead>
            <tbody class="table-group-divider">
                {% for video in videos %}
                    <tr>
                        <td>{{ video[0] }}</td>
                        {% if video[1]==None %}
                            <td></td>
                        {% else %}
                            <td>{{ video[1] }}</td>
                        {% endif %}
                        <td>{{ video[2] }}</td>
                        <td>{{ video[5] }}</td>
                        <td>{{ video[6] }}</td>
                        <td>{{ video[7] }}</td>
                        <td>{{ video[8] }}</td>
                        {% autoescape false %}
                            <td><button type="button" class="btn btn-primary" onclick="openModal('{{ video[0] }}',' {{ video[8] }}', '{{ video[9] | replace("\\","\\\\") |forceescape }}')" >Update Status</button></td>
                        {% endautoescape %}
                        {% if video[9]==None %}
                            <td></td>
                        {% else %}
                            <td>{{ video[9] }}</td>
                        {% endif %}
                        {% if sessionvar['user_type'] < 3 or sessionvar['user_type'] == 4 %}
                        <td><a href="{{ url_for("edit_video", video_id=video[0]) }}" class="btn btn-primary">Edit</a></td>
                        {% endif %}
                        {% if sessionvar['user_type'] < 3 %}
                            <td><a href="{{url_for("delete_video",video_id=video[0])}}" class="btn btn-danger">Delete</a></td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <a class="btn btn-primary" href="{{url_for('add_video', channel_id=channel[0]) }}">Add Video</a>
        <br><br>
        <a class="btn btn-primary" href="#">Click to view channel statistics</a>

        {# MODAL DEFINITION #}
        <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="updateModalLabel">Update Video Status</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="{{url_for('update_status')}}" method="post" id="updateStatusForm">
                            <input type="hidden" name="video_id" id="video_id">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control" required>
                                    <option disabled selected value> Set Video Status </option>
                                    
                                    {% if sessionvar['user_type'] <= 1 %}
                                        <option value="0">To be created</option>
                                        <option value="1">Shot</option>
                                        <option value="2">Edited</option>
                                        <option value="3">To be Reshot</option>
                                        <option value="4">To be Re-edited</option>
                                        <option value="6">Uploaded</option>
                                        <option value="7">Deleted</option>
                                    {% elif sessionvar['user_type'] == 2 %}
                                        <option value="3">To be Reshot</option>
                                        <option value="4">To be Re-edited</option>
                                        <option value="6">Uploaded</option>
                                    {% elif sessionvar['user_type'] == 3 %}
                                        <option value="2">Edited</option>
                                    {% elif sessionvar['user_type'] == 4 %}
                                        <option value="1">Shot</option>
                                    {% endif %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="comment">Comment</label>
                                <textarea name="comment" id="comment" class="form-control"></textarea>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
    <script>
    function openModal(video_id, status, comment) {
        const myModal = new bootstrap.Modal(document.getElementById('updateModal'), {keyboard:false})
        const toggleModal = document.getElementById('updateModal')
        console.log("ping")
        user_type = {{ sessionvar['user_type'] }};
        if (user_type == 4) {
            if (status != 0 && status != 3) {
                alert("You are not allowed to change the status of this video");
                return;
            }
        } else if (user_type == 3) {
            if (status != 1 && status != 4) {
                alert("You are not allowed to change the status of this video");
                return;
            }
        } else if (user_type == 2) {
            if (status != 2) {
                alert("You are not allowed to change the status of this video");
                return;
            }
        }
        document.getElementById('video_id').value = video_id;
        document.getElementById('status').value = status;
        if (comment == "None"){
            comment = "";
        }
        document.getElementById('comment').value = comment;
        myModal.show(toggleModal);
    }
</script>
</body>
</html>